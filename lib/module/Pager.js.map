{"version":3,"sources":["Pager.tsx"],"names":["React","useState","useRef","useEffect","Animated","runOnUI","useSharedValue","useAnimatedStyle","interpolate","Easing","Extrapolate","withTiming","withSpring","cancelAnimation","useDerivedValue","Dimensions","StyleSheet","View","Image","Platform","PanGestureHandler","TapGestureHandler","useAnimatedGestureHandler","ImageTransformer","friction","fixGestureHandler","getShouldRender","vec","dimensions","get","GUTTER_WIDTH","width","FAR_FAR_AWAY","getPageTranslate","i","t","g","styles","create","backdrop","flex","backgroundColor","pager","flexDirection","AnimatedImage","createAnimatedComponent","Gutter","Page","memo","shouldRender","pagerRefs","page","onPageStateChange","gutterWidth","index","length","targetWidth","scaleFactor","item","targetHeight","height","position","top","bottom","left","justifyContent","alignItems","uri","timingConfig","duration","easing","bezier","ImagePager","gallery","pagerRef","tapRef","isActive","value","imageWrapperPosition","pagerPosition","setPagerVisible","measurements","activeItem","Error","activeImage","setActiveImage","animationProgress","scale","backdropOpacity","statusBarFix","OS","velocity","x","y","target","useSharedVector","translate","diffValue","setDiffValue","disposer","addOnChangeListener","nextItem","setCurrentImageOpacity","opacity","err","console","log","afterOpen","onClose","openAnimation","imageStyles","range","CLAMP","translateY","translateX","transform","backdropStyles","activeIndex","setActiveIndex","totalCount","pagerX","toValueAnimation","gestureTranslationX","offsetX","totalWidth","getTranslate","onIndexChange","nextIndex","onChangePageAnimation","stiffness","damping","mass","overshootClamping","restDisplacementThreshold","restSpeedThreshold","canSwipe","nextTranslate","totalTranslate","getNextIndex","v","currentTranslate","Math","abs","currentIndex","currentOffset","isPagerInProgress","floor","onPan","shouldHandleEvent","evt","numberOfPointers","onEvent","translationX","velocityX","onStart","ctx","isHorizontalSwipe","velocityY","pagerActive","onActive","translationY","onEnd","shouldMoveToNextPage","config","onFinish","_","onTap","pagerWrapperStyles","pagerStyles","imageWrapperStyles","absoluteFillObject","absoluteFill","images","map","toString"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport Animated, {\n  runOnUI,\n  useSharedValue,\n  useAnimatedStyle,\n  interpolate,\n  Easing,\n  Extrapolate,\n  withTiming,\n  withSpring,\n  cancelAnimation,\n  useDerivedValue,\n} from 'react-native-reanimated';\nimport {\n  Dimensions,\n  StyleSheet,\n  View,\n  Image,\n  Platform,\n  ViewStyle,\n  ImageStyle,\n} from 'react-native';\nimport {\n  PanGestureHandler,\n  TapGestureHandler,\n  PanGestureHandlerGestureEvent,\n} from 'react-native-gesture-handler';\nimport { GalleryState, IGalleryImage } from './GalleryState';\nimport { useAnimatedGestureHandler } from './useAnimatedGestureHandler';\nimport { ImageTransformer } from './ImageTransformer';\n\nimport {\n  friction,\n  fixGestureHandler,\n  getShouldRender,\n} from './utils';\nimport * as vec from './vectors';\n\nconst dimensions = Dimensions.get('window');\n\nconst GUTTER_WIDTH = dimensions.width / 14;\nconst FAR_FAR_AWAY = 9999;\n\nconst getPageTranslate = (i: number) => {\n  const t = i * dimensions.width;\n  const g = GUTTER_WIDTH * i;\n  return -(t + g);\n};\n\nconst styles = StyleSheet.create({\n  backdrop: {\n    flex: 1,\n    backgroundColor: 'black',\n  },\n  pager: {\n    flex: 1,\n    flexDirection: 'row',\n  },\n});\n\nconst AnimatedImage = Animated.createAnimatedComponent(\n  Image,\n) as typeof Animated.Image;\n\ntype IGutterProps = {\n  width: number;\n};\n\nfunction Gutter({ width }: IGutterProps) {\n  return <View style={{ width }} />;\n}\n\ntype IPageProps = {\n  shouldRender: boolean;\n  pagerRefs: React.Ref<any>[];\n  page: IGalleryImage;\n  onPageStateChange: (value: boolean) => void;\n  gutterWidth: number;\n  index: number;\n  length: number;\n};\n\nconst Page = React.memo<IPageProps>(\n  ({\n    shouldRender,\n    pagerRefs,\n    page,\n    onPageStateChange,\n    gutterWidth,\n    index,\n    length,\n  }) => {\n    if (!shouldRender) {\n      return null;\n    }\n\n    const targetWidth = dimensions.width;\n    const scaleFactor = page.item.width / targetWidth;\n    const targetHeight = page.item.height / scaleFactor;\n\n    return (\n      <View\n        style={{\n          flex: 1,\n          position: 'absolute',\n          top: 0,\n          bottom: 0,\n          left: -getPageTranslate(index),\n        }}\n      >\n        <View\n          style={[\n            {\n              flex: 1,\n              width: dimensions.width,\n              justifyContent: 'center',\n              alignItems: 'center',\n            },\n          ]}\n        >\n          <ImageTransformer\n            {...{\n              pagerRefs,\n              onPageStateChange,\n              uri: page.item.uri,\n              width: targetWidth,\n              height: targetHeight,\n            }}\n          />\n        </View>\n\n        {index !== length - 1 && <Gutter width={gutterWidth} />}\n      </View>\n    );\n  },\n);\n\nconst timingConfig = {\n  duration: 250,\n  easing: Easing.bezier(0.33, 0.01, 0, 1),\n};\n\ntype IImagePager = {\n  gallery: GalleryState;\n};\n\nexport function ImagePager({ gallery }: IImagePager) {\n  fixGestureHandler();\n\n  const pagerRef = useRef(null);\n  const tapRef = useRef(null);\n\n  const isActive = useSharedValue(true);\n\n  function onPageStateChange(value: boolean) {\n    'worklet';\n\n    isActive.value = value;\n  }\n\n  const imageWrapperPosition = useSharedValue(0);\n  const pagerPosition = useSharedValue(FAR_FAR_AWAY);\n\n  const setPagerVisible = (value: boolean) => {\n    'worklet';\n\n    imageWrapperPosition.value = value ? FAR_FAR_AWAY : 0;\n    pagerPosition.value = value ? 0 : FAR_FAR_AWAY;\n  };\n\n  // S1: Image transition stuff\n  const { measurements, item } = gallery.activeItem!;\n\n  if (!measurements) {\n    throw new Error(\n      'Gallery Pager: Active item should have measurements',\n    );\n  }\n\n  const [activeImage, setActiveImage] = useState(item.uri);\n\n  const animationProgress = useSharedValue(0);\n  const scale = useSharedValue(1);\n  const backdropOpacity = useSharedValue(0);\n  const statusBarFix = Platform.OS === 'android' ? 12 : 0;\n\n  const velocity = useSharedValue(0);\n  const x = useSharedValue(measurements.x);\n  const width = useSharedValue(measurements.width);\n  const height = useSharedValue(measurements.height);\n  const targetWidth = useSharedValue(measurements.targetWidth);\n  const targetHeight = useSharedValue(measurements.targetHeight);\n  const y = useSharedValue(measurements.y);\n  const target = vec.useSharedVector(\n    0,\n    (dimensions.height - measurements.targetHeight) / 2 -\n      statusBarFix,\n  );\n  const translate = vec.useSharedVector(0, 0);\n\n  const [diffValue, setDiffValue] = useState(0);\n\n  useEffect(() => {\n    const disposer = gallery.addOnChangeListener((nextItem) => {\n      if (!nextItem.measurements) {\n        throw new Error('Item should have measurements');\n      }\n\n      x.value = nextItem.measurements.x;\n      width.value = nextItem.measurements.width;\n      height.value = nextItem.measurements.height;\n      targetWidth.value = nextItem.measurements.targetWidth;\n      targetHeight.value = nextItem.measurements.targetHeight;\n      y.value = nextItem.measurements.y;\n      target.y.value =\n        (dimensions.height - nextItem.measurements.targetHeight) / 2 -\n        statusBarFix;\n\n      setActiveImage(nextItem.item.uri);\n\n      setCurrentImageOpacity(0);\n    });\n\n    return disposer;\n  }, []);\n\n  function setCurrentImageOpacity(value: 0 | 1) {\n    try {\n      gallery.activeItem!.opacity.value = value;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.log('Error changing opacity');\n    }\n  }\n\n  // S1: Callbacks\n  function afterOpen() {\n    setCurrentImageOpacity(0);\n    setDiffValue(2);\n  }\n\n  function onClose() {\n    setCurrentImageOpacity(1);\n\n    gallery.onClose();\n  }\n\n  // S1: Animations\n  const openAnimation = () => {\n    'worklet';\n\n    animationProgress.value = withTiming(1, timingConfig, () => {\n      setPagerVisible(true);\n      afterOpen();\n    });\n    backdropOpacity.value = withTiming(1, timingConfig);\n  };\n\n  useEffect(() => {\n    runOnUI(openAnimation)();\n  }, []);\n\n  // S1: Styles\n\n  const imageStyles = useAnimatedStyle<ImageStyle>(() => {\n    const i = (range: [number, number]) =>\n      interpolate(\n        animationProgress.value,\n        [0, 1],\n        range,\n        Extrapolate.CLAMP,\n      );\n\n    const translateY =\n      translate.y.value + i([y.value, target.y.value]);\n    const translateX =\n      translate.x.value + i([x.value, target.x.value]);\n\n    return {\n      top: translateY,\n      left: translateX,\n      width: i([width.value, targetWidth.value]),\n      height: i([height.value, targetHeight.value]),\n      transform: [\n        {\n          scale: scale.value,\n        },\n      ],\n    };\n  });\n\n  const backdropStyles = useAnimatedStyle<ViewStyle>(() => {\n    return {\n      opacity: backdropOpacity.value,\n    };\n  });\n\n  // S2: Pager related stuff\n  const [activeIndex, setActiveIndex] = useState(\n    gallery.activeItem!.index,\n  );\n\n  const index = useSharedValue(gallery.activeItem!.index);\n  const length = useSharedValue(gallery.totalCount);\n  const pagerX = useSharedValue(0);\n  const toValueAnimation = useSharedValue(\n    getPageTranslate(gallery.activeItem!.index),\n  );\n  const gestureTranslationX = useSharedValue(0);\n\n  const offsetX = useSharedValue(\n    getPageTranslate(gallery.activeItem!.index),\n  );\n\n  const totalWidth = useDerivedValue(() => {\n    return (\n      length.value * dimensions.width +\n      GUTTER_WIDTH * length.value -\n      2\n    );\n  });\n\n  const getTranslate = (i: number) => {\n    'worklet';\n\n    const t = i * dimensions.width;\n    const g = GUTTER_WIDTH * i;\n    return t + g;\n  };\n\n  async function onIndexChange() {\n    const nextIndex = index.value;\n    setCurrentImageOpacity(1);\n\n    await gallery.setActiveIndex(nextIndex);\n\n    setActiveIndex(nextIndex);\n  }\n\n  const onChangePageAnimation = () => {\n    'worklet';\n\n    offsetX.value = withSpring(toValueAnimation.value, {\n      stiffness: 1000,\n      damping: 500,\n      mass: 3,\n      overshootClamping: true,\n      restDisplacementThreshold: 0.01,\n      restSpeedThreshold: 0.01,\n      velocity: velocity.value,\n    });\n  };\n\n  // S3 Pager\n  const canSwipe = useDerivedValue(() => {\n    const nextTranslate = offsetX.value + gestureTranslationX.value;\n\n    if (nextTranslate > 0) {\n      return false;\n    }\n\n    const totalTranslate =\n      dimensions.width * (length.value - 1) +\n      GUTTER_WIDTH * (length.value - 1);\n\n    if (nextTranslate <= -totalTranslate) {\n      return false;\n    }\n\n    return true;\n  });\n\n  const getNextIndex = (v: number) => {\n    'worklet';\n\n    const currentTranslate = Math.abs(getTranslate(index.value));\n    const currentIndex = index.value;\n    const currentOffset = Math.abs(offsetX.value);\n\n    const nextIndex = v < 0 ? currentIndex + 1 : currentIndex - 1;\n\n    if (\n      nextIndex < currentIndex &&\n      currentOffset > currentTranslate\n    ) {\n      return currentIndex;\n    }\n\n    if (\n      nextIndex > currentIndex &&\n      currentOffset < currentTranslate\n    ) {\n      return currentIndex;\n    }\n\n    if (nextIndex > length.value - 1 || nextIndex < 0) {\n      return currentIndex;\n    }\n\n    return nextIndex;\n  };\n\n  const isPagerInProgress = useDerivedValue(() => {\n    return (\n      Math.floor(getTranslate(index.value)) !==\n      Math.floor(Math.abs(offsetX.value + pagerX.value))\n    );\n  });\n\n  const onPan = useAnimatedGestureHandler<\n    PanGestureHandlerGestureEvent,\n    {\n      pagerActive: boolean;\n    }\n  >({\n    shouldHandleEvent: (evt) => {\n      return (\n        evt.numberOfPointers === 1 &&\n        isActive.value &&\n        animationProgress.value === 1\n      );\n    },\n\n    onEvent: (evt) => {\n      gestureTranslationX.value = evt.translationX;\n      velocity.value = evt.velocityX;\n    },\n\n    onStart: (evt, ctx) => {\n      const isHorizontalSwipe =\n        Math.abs(evt.velocityX) > Math.abs(evt.velocityY);\n\n      if (isHorizontalSwipe || isPagerInProgress.value) {\n        setPagerVisible(true);\n        ctx.pagerActive = true;\n      } else {\n        setPagerVisible(false);\n      }\n    },\n\n    onActive: (evt, ctx) => {\n      if (ctx.pagerActive) {\n        pagerX.value = canSwipe.value\n          ? evt.translationX\n          : friction(evt.translationX);\n      } else {\n        translate.y.value = evt.translationY;\n        translate.x.value = evt.translationX;\n\n        scale.value = interpolate(\n          translate.y.value,\n          [-200, 0, 200],\n          [0.65, 1, 0.65],\n          Extrapolate.CLAMP,\n        );\n\n        backdropOpacity.value = interpolate(\n          translate.y.value,\n          [-100, 0, 100],\n          [0, 1, 0],\n          Extrapolate.CLAMP,\n        );\n      }\n    },\n\n    onEnd: (evt, ctx) => {\n      if (ctx.pagerActive) {\n        offsetX.value += pagerX.value;\n        pagerX.value = 0;\n\n        const nextIndex = getNextIndex(evt.velocityX);\n\n        const v = Math.abs(evt.velocityX);\n\n        const shouldMoveToNextPage = v > 10 && canSwipe.value;\n\n        // we invert the value since the tranlationY is left to right\n        toValueAnimation.value = -(shouldMoveToNextPage\n          ? getTranslate(nextIndex)\n          : getTranslate(index.value));\n\n        onChangePageAnimation();\n\n        if (shouldMoveToNextPage) {\n          index.value = nextIndex;\n          onIndexChange();\n        }\n      } else {\n        const easing = Easing.bezier(0.33, 0.01, 0, 1);\n        const config = {\n          duration: 200,\n          easing,\n        };\n\n        if (Math.abs(translate.y.value) > 40) {\n          target.x.value = translate.x.value - target.x.value * -1;\n          target.y.value = translate.y.value - target.y.value * -1;\n\n          translate.x.value = 0;\n          translate.y.value = 0;\n\n          animationProgress.value = withTiming(\n            0,\n            {\n              duration: 400,\n              easing,\n            },\n            () => {\n              onClose();\n            },\n          );\n          scale.value = withTiming(1, {\n            duration: 400,\n            easing,\n          });\n\n          backdropOpacity.value = withTiming(0, config);\n        } else {\n          translate.x.value = withTiming(0, config);\n          translate.y.value = withTiming(0, config);\n          backdropOpacity.value = withTiming(1, config);\n          scale.value = withTiming(1, config, () => {\n            setPagerVisible(true);\n          });\n        }\n      }\n    },\n\n    onFinish: (_, ctx) => {\n      ctx.pagerActive = false;\n    },\n  });\n\n  const onTap = useAnimatedGestureHandler({\n    shouldHandleEvent: (evt) => {\n      return (\n        evt.numberOfPointers === 1 &&\n        isActive.value &&\n        animationProgress.value === 1\n      );\n    },\n\n    onStart: () => {\n      if (scale.value !== 1) {\n        return;\n      }\n      cancelAnimation(offsetX);\n    },\n\n    onEnd: () => {\n      if (scale.value !== 1) {\n        return;\n      }\n\n      onChangePageAnimation();\n    },\n  });\n\n  const pagerWrapperStyles = useAnimatedStyle(() => {\n    return {\n      transform: [\n        {\n          translateY: pagerPosition.value,\n        },\n      ],\n    };\n  });\n\n  const pagerStyles = useAnimatedStyle<ViewStyle>(() => {\n    return {\n      width: totalWidth.value,\n      transform: [\n        {\n          translateX: pagerX.value + offsetX.value,\n        },\n      ],\n    };\n  });\n\n  const imageWrapperStyles = useAnimatedStyle<ViewStyle>(() => {\n    return {\n      transform: [\n        {\n          translateX: imageWrapperPosition.value,\n        },\n      ],\n    };\n  });\n\n  return (\n    <View style={StyleSheet.absoluteFillObject}>\n      <Animated.View style={[styles.backdrop, backdropStyles]} />\n\n      <Animated.View style={[StyleSheet.absoluteFill]}>\n        <PanGestureHandler\n          ref={pagerRef}\n          simultaneousHandlers={[tapRef]}\n          onGestureEvent={onPan}\n          onHandlerStateChange={onPan}\n        >\n          <Animated.View style={StyleSheet.absoluteFill}>\n            <Animated.View\n              style={[StyleSheet.absoluteFill, imageWrapperStyles]}\n            >\n              <AnimatedImage\n                source={{ uri: activeImage }}\n                style={imageStyles}\n              />\n            </Animated.View>\n\n            <Animated.View\n              style={[StyleSheet.absoluteFill, pagerWrapperStyles]}\n            >\n              <TapGestureHandler\n                ref={tapRef}\n                // TODO: Fix tap gesture handler\n                enabled={false}\n                simultaneousHandlers={[pagerRef]}\n                onGestureEvent={onTap}\n                onHandlerStateChange={onTap}\n              >\n                <Animated.View style={StyleSheet.absoluteFill}>\n                  <Animated.View style={[styles.pager, pagerStyles]}>\n                    {gallery.images.map((page, i) => (\n                      <Page\n                        key={i.toString()}\n                        page={page}\n                        pagerRefs={[pagerRef, tapRef]}\n                        onPageStateChange={onPageStateChange}\n                        index={i}\n                        length={gallery.totalCount}\n                        shouldRender={getShouldRender(\n                          i,\n                          activeIndex,\n                          diffValue,\n                        )}\n                        gutterWidth={GUTTER_WIDTH}\n                      />\n                    ))}\n                  </Animated.View>\n                </Animated.View>\n              </TapGestureHandler>\n            </Animated.View>\n          </Animated.View>\n        </PanGestureHandler>\n      </Animated.View>\n    </View>\n  );\n}\n"]}