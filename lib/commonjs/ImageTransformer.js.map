{"version":3,"sources":["ImageTransformer.tsx"],"names":["windowDimensions","width","Dimensions","get","height","styles","fill","StyleSheet","absoluteFillObject","wrapper","justifyContent","alignItems","container","flex","backgroundColor","springConfig","stiffness","damping","mass","overshootClamping","restDisplacementThreshold","restSpeedThreshold","timingConfig","duration","easing","Easing","bezier","ImageTransformer","React","memo","pagerRefs","source","uri","onPageStateChange","imageSource","MAX_SCALE","MIN_SCALE","OVER_SCALE","pinchRef","panRef","tapRef","panState","pinchState","scale","scaleOffset","translation","vec","useSharedVector","panVelocity","scaleTranslation","offset","canvas","create","targetWidth","scaleFactor","targetHeight","image","canPanVertically","value","maybeRunOnEnd","target","fixedScale","scaledImage","y","rightBoundary","x","topBoundary","Math","abs","maxVector","minVector","invert","eq","set","clamp","deceleration","velocity","onPanEvent","onInit","_","ctx","panOffset","beforeEach","evt","pan","translationX","translationY","velocityX","velocityY","shouldHandleEvent","onStart","onActive","state","numberOfPointers","nextTranslate","add","onEnd","onScaleEvent","origin","gestureScale","nextScale","focal","focalX","focalY","CENTER","divide","adjustFocal","sub","afterEach","pinch","nextTranslation","multiply","onTapEvent","animatedStyles","noOffset","noTranslation","noScaleTranslation","pagerNextState","transform","translateX","translateY"],"mappings":"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","sourcesContent":["import React, { useRef } from 'react';\nimport {\n  StyleSheet,\n  Dimensions,\n  Image,\n  ImageRequireSource,\n  ViewStyle,\n} from 'react-native';\nimport Animated, {\n  withSpring,\n  withTiming,\n  useSharedValue,\n  useAnimatedStyle,\n  cancelAnimation,\n  useDerivedValue,\n  Easing,\n} from 'react-native-reanimated';\nimport {\n  PinchGestureHandler,\n  PanGestureHandler,\n  TapGestureHandler,\n  State,\n  PanGestureHandlerGestureEvent,\n  PinchGestureHandlerGestureEvent,\n} from 'react-native-gesture-handler';\nimport * as vec from './vectors';\nimport { useAnimatedGestureHandler } from './useAnimatedGestureHandler';\nimport withDecay from './withDecay';\nimport { fixGestureHandler, clamp } from './utils';\n\nconst windowDimensions = {\n  width: Dimensions.get('window').width,\n  height: Dimensions.get('window').height,\n};\n\nconst styles = {\n  fill: {\n    ...StyleSheet.absoluteFillObject,\n  },\n  wrapper: {\n    ...StyleSheet.absoluteFillObject,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  container: {\n    flex: 1,\n    backgroundColor: 'black',\n  },\n};\n\nconst springConfig = {\n  stiffness: 1000,\n  damping: 500,\n  mass: 3,\n  overshootClamping: true,\n  restDisplacementThreshold: 0.01,\n  restSpeedThreshold: 0.01,\n};\n\nconst timingConfig = {\n  duration: 250,\n  easing: Easing.bezier(0.33, 0.01, 0, 1),\n};\n\ntype IImageTransformerProps = {\n  pagerRefs: React.Ref<any>[];\n  source?: ImageRequireSource;\n  uri?: string;\n  width: number;\n  height: number;\n  onPageStateChange: (nextPagerState: boolean) => void;\n};\n\nexport const ImageTransformer = React.memo<IImageTransformerProps>(\n  ({\n    pagerRefs = [],\n    source,\n    uri,\n    width,\n    height,\n    onPageStateChange = () => {},\n  }) => {\n    fixGestureHandler();\n\n    const imageSource = source ?? {\n      uri,\n    };\n\n    const MAX_SCALE = 3;\n    const MIN_SCALE = 0.7;\n    const OVER_SCALE = 0.5;\n\n    const pinchRef = useRef(null);\n    const panRef = useRef(null);\n    const tapRef = useRef(null);\n\n    const panState = useSharedValue<State>(-1);\n    const pinchState = useSharedValue<State>(-1);\n\n    const scale = useSharedValue(1);\n    const scaleOffset = useSharedValue(1);\n    const translation = vec.useSharedVector(0, 0);\n    const panVelocity = vec.useSharedVector(0, 0);\n    const scaleTranslation = vec.useSharedVector(0, 0);\n    const offset = vec.useSharedVector(0, 0);\n\n    const canvas = vec.create(\n      windowDimensions.width,\n      windowDimensions.height,\n    );\n    const targetWidth = windowDimensions.width;\n    const scaleFactor = width / targetWidth;\n    const targetHeight = height / scaleFactor;\n    const image = vec.create(targetWidth, targetHeight);\n\n    const canPanVertically = useDerivedValue(() => {\n      return windowDimensions.height < targetHeight * scale.value;\n    });\n\n    const maybeRunOnEnd = () => {\n      'worklet';\n\n      const target = vec.create(0, 0);\n\n      const fixedScale = clamp(MIN_SCALE, scale.value, MAX_SCALE);\n      const scaledImage = image.y * fixedScale;\n      const rightBoundary = (canvas.x / 2) * (fixedScale - 1);\n\n      let topBoundary = 0;\n\n      if (canvas.y < scaledImage) {\n        topBoundary = Math.abs(scaledImage - canvas.y) / 2;\n      }\n\n      const maxVector = vec.create(rightBoundary, topBoundary);\n      const minVector = vec.invert(maxVector);\n\n      if (!canPanVertically.value) {\n        offset.y.value = withSpring(target.y, springConfig);\n      }\n\n      if (panState.value !== 5 || pinchState.value !== 5) {\n        return;\n      }\n\n      if (\n        vec.eq(offset, 0) &&\n        vec.eq(translation, 0) &&\n        vec.eq(scaleTranslation, 0) &&\n        scale.value === 1\n      ) {\n        // we don't need to run any animations\n        return;\n      }\n\n      if (scale.value <= 1) {\n        // just center it\n        vec.set(target, 0);\n      } else {\n        vec.set(target, vec.clamp(offset, minVector, maxVector));\n      }\n\n      const deceleration = 0.991;\n\n      if (\n        target.x === offset.x.value &&\n        Math.abs(panVelocity.x.value) > 0 &&\n        scale.value <= MAX_SCALE\n      ) {\n        offset.x.value = withDecay({\n          velocity: panVelocity.x.value,\n          clamp: [minVector.x, maxVector.x],\n          deceleration,\n        });\n      } else {\n        // run animation\n        offset.x.value = withSpring(target.x, springConfig);\n      }\n\n      if (\n        target.y === offset.y.value &&\n        Math.abs(panVelocity.y.value) > 0 &&\n        scale.value <= MAX_SCALE\n      ) {\n        offset.y.value = withDecay({\n          velocity: panVelocity.y.value,\n          clamp: [minVector.y, maxVector.y],\n          deceleration,\n        });\n      } else {\n        offset.y.value = withSpring(target.y, springConfig);\n      }\n    };\n\n    const onPanEvent = useAnimatedGestureHandler<\n      PanGestureHandlerGestureEvent,\n      {\n        panOffset: vec.Vector<number>;\n        pan: vec.Vector<number>;\n      }\n    >({\n      onInit: (_, ctx) => {\n        ctx.panOffset = vec.create(0, 0);\n      },\n\n      beforeEach: (evt, ctx) => {\n        ctx.pan = vec.create(evt.translationX, evt.translationY);\n        const velocity = vec.create(evt.velocityX, evt.velocityY);\n\n        vec.set(panVelocity, velocity);\n      },\n\n      shouldHandleEvent: () => {\n        return true;\n      },\n\n      onStart: (_, ctx) => {\n        cancelAnimation(offset.x);\n        cancelAnimation(offset.y);\n        ctx.panOffset = vec.create(0, 0);\n      },\n\n      onActive: (evt, ctx) => {\n        panState.value = evt.state;\n\n        if (scale.value > 1) {\n          if (evt.numberOfPointers > 1) {\n            // store pan offset during the pan with two fingers (during the pinch)\n            vec.set(ctx.panOffset, ctx.pan);\n          } else {\n            // subtract the offset and assign fixed pan\n            const nextTranslate = vec.add([\n              ctx.pan,\n              vec.invert(ctx.panOffset),\n            ]);\n            translation.x.value = nextTranslate.x;\n\n            if (canPanVertically.value) {\n              translation.y.value = nextTranslate.y;\n            }\n          }\n        }\n      },\n\n      onEnd: (evt, ctx) => {\n        panState.value = evt.state;\n\n        vec.set(ctx.panOffset, 0);\n        vec.set(offset, vec.add([offset, translation]));\n        vec.set(translation, 0);\n\n        maybeRunOnEnd();\n      },\n    });\n\n    const onScaleEvent = useAnimatedGestureHandler<\n      PinchGestureHandlerGestureEvent,\n      {\n        origin: vec.Vector<number>;\n        adjustFocal: vec.Vector<number>;\n        gestureScale: number;\n        nextScale: number;\n      }\n    >({\n      onInit: (_, ctx) => {\n        ctx.origin = vec.create(0, 0);\n        ctx.gestureScale = 1;\n      },\n\n      shouldHandleEvent: () => {\n        return true;\n      },\n\n      beforeEach: (evt, ctx) => {\n        // calculate the overall scale value\n        // also limits this.event.scale\n        ctx.nextScale = clamp(\n          evt.scale * scaleOffset.value,\n          MIN_SCALE,\n          MAX_SCALE + OVER_SCALE,\n        );\n\n        if (\n          ctx.nextScale > MIN_SCALE &&\n          ctx.nextScale < MAX_SCALE + OVER_SCALE\n        ) {\n          ctx.gestureScale = evt.scale;\n        }\n\n        // this is just to be able to use with vectors\n        const focal = vec.create(evt.focalX, evt.focalY);\n        const CENTER = vec.divide([canvas, 2]);\n\n        // focal with translate offset\n        // it alow us to scale into different point even then we pan the image\n        ctx.adjustFocal = vec.sub([focal, vec.add([CENTER, offset])]);\n      },\n\n      afterEach: (evt, ctx) => {\n        if (evt.state === 5) {\n          return;\n        }\n\n        scale.value = ctx.nextScale;\n      },\n\n      onStart: (_, ctx) => {\n        vec.set(ctx.origin, ctx.adjustFocal);\n      },\n\n      onActive: (evt, ctx) => {\n        pinchState.value = evt.state;\n\n        const pinch = vec.sub([ctx.adjustFocal, ctx.origin]);\n\n        const nextTranslation = vec.add([\n          pinch,\n          ctx.origin,\n          vec.multiply([-1, ctx.gestureScale, ctx.origin]),\n        ]);\n\n        vec.set(scaleTranslation, nextTranslation);\n      },\n\n      onEnd: (evt, ctx) => {\n        // reset gestureScale value\n        ctx.gestureScale = 1;\n        pinchState.value = evt.state;\n        // store scale value\n        scaleOffset.value = scale.value;\n\n        vec.set(offset, vec.add([offset, scaleTranslation]));\n        vec.set(scaleTranslation, 0);\n\n        if (scaleOffset.value < 1) {\n          // make sure we don't add stuff below the 1\n          scaleOffset.value = 1;\n\n          // this runs the spring animation\n          scale.value = withTiming(1, timingConfig);\n        } else if (scaleOffset.value > MAX_SCALE) {\n          scaleOffset.value = MAX_SCALE;\n          scale.value = withTiming(MAX_SCALE, timingConfig);\n        }\n\n        maybeRunOnEnd();\n      },\n    });\n\n    // FIXME: Tap gesture handler is not working\n    const onTapEvent = useAnimatedGestureHandler({\n      onStart: () => {\n        cancelAnimation(offset.x);\n        cancelAnimation(offset.y);\n      },\n\n      onEnd: () => {\n        maybeRunOnEnd();\n      },\n    });\n\n    const animatedStyles = useAnimatedStyle<ViewStyle>(() => {\n      const noOffset = offset.x.value === 0 && offset.y.value === 0;\n      const noTranslation =\n        translation.x.value === 0 && translation.y.value === 0;\n      const noScaleTranslation =\n        scaleTranslation.x.value === 0 &&\n        scaleTranslation.y.value === 0;\n\n      const pagerNextState =\n        scale.value === 1 &&\n        noOffset &&\n        noTranslation &&\n        noScaleTranslation;\n\n      onPageStateChange(pagerNextState);\n\n      return {\n        transform: [\n          {\n            translateX:\n              scaleTranslation.x.value +\n              translation.x.value +\n              offset.x.value,\n          },\n          {\n            translateY:\n              scaleTranslation.y.value +\n              translation.y.value +\n              offset.y.value,\n          },\n          { scale: scale.value },\n        ],\n      };\n    });\n\n    return (\n      <Animated.View\n        style={[styles.container, { width: windowDimensions.width }]}\n      >\n        <PinchGestureHandler\n          ref={pinchRef}\n          // enabled={false}\n          onGestureEvent={onScaleEvent}\n          simultaneousHandlers={[panRef, tapRef, ...pagerRefs]}\n          onHandlerStateChange={onScaleEvent}\n        >\n          <Animated.View style={styles.fill}>\n            <PanGestureHandler\n              ref={panRef}\n              minDist={5}\n              avgTouches\n              simultaneousHandlers={[pinchRef, tapRef, ...pagerRefs]}\n              onGestureEvent={onPanEvent}\n              onHandlerStateChange={onPanEvent}\n            >\n              <Animated.View style={styles.fill}>\n                <TapGestureHandler\n                  ref={tapRef}\n                  numberOfTaps={1}\n                  simultaneousHandlers={[\n                    pinchRef,\n                    panRef,\n                    ...pagerRefs,\n                  ]}\n                  onGestureEvent={onTapEvent}\n                  onHandlerStateChange={onTapEvent}\n                >\n                  <Animated.View style={styles.fill}>\n                    <Animated.View style={styles.wrapper}>\n                      <Animated.View style={animatedStyles}>\n                        <Image\n                          source={imageSource}\n                          // resizeMode=\"cover\"\n                          style={{\n                            width: targetWidth,\n                            height: targetHeight,\n                          }}\n                        />\n                      </Animated.View>\n                    </Animated.View>\n                  </Animated.View>\n                </TapGestureHandler>\n              </Animated.View>\n            </PanGestureHandler>\n          </Animated.View>\n        </PinchGestureHandler>\n      </Animated.View>\n    );\n  },\n);\n"]}