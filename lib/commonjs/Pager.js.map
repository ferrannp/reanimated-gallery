{"version":3,"sources":["Pager.tsx"],"names":["dimensions","Dimensions","get","GUTTER_WIDTH","width","FAR_FAR_AWAY","getPageTranslate","i","t","g","styles","StyleSheet","create","backdrop","flex","backgroundColor","pager","flexDirection","AnimatedImage","Animated","createAnimatedComponent","Image","Gutter","Page","React","memo","shouldRender","pagerRefs","page","onPageStateChange","gutterWidth","index","length","targetWidth","scaleFactor","item","targetHeight","height","position","top","bottom","left","justifyContent","alignItems","uri","timingConfig","duration","easing","Easing","bezier","ImagePager","gallery","pagerRef","tapRef","isActive","value","imageWrapperPosition","pagerPosition","setPagerVisible","measurements","activeItem","Error","activeImage","setActiveImage","animationProgress","scale","backdropOpacity","statusBarFix","Platform","OS","velocity","x","y","target","vec","useSharedVector","translate","diffValue","setDiffValue","disposer","addOnChangeListener","nextItem","setCurrentImageOpacity","opacity","err","console","log","afterOpen","onClose","openAnimation","imageStyles","range","Extrapolate","CLAMP","translateY","translateX","transform","backdropStyles","activeIndex","setActiveIndex","totalCount","pagerX","toValueAnimation","gestureTranslationX","offsetX","totalWidth","getTranslate","onIndexChange","nextIndex","onChangePageAnimation","stiffness","damping","mass","overshootClamping","restDisplacementThreshold","restSpeedThreshold","canSwipe","nextTranslate","totalTranslate","getNextIndex","v","currentTranslate","Math","abs","currentIndex","currentOffset","isPagerInProgress","floor","onPan","shouldHandleEvent","evt","numberOfPointers","onEvent","translationX","velocityX","onStart","ctx","isHorizontalSwipe","velocityY","pagerActive","onActive","translationY","onEnd","shouldMoveToNextPage","config","onFinish","_","onTap","pagerWrapperStyles","pagerStyles","imageWrapperStyles","absoluteFillObject","absoluteFill","images","map","toString"],"mappings":";;;;;;;AAAA;;AACA;;AAYA;;AASA;;AAMA;;AACA;;AAEA;;AAKA;;;;;;AAEA,MAAMA,UAAU,GAAGC,wBAAWC,GAAX,CAAe,QAAf,CAAnB;;AAEA,MAAMC,YAAY,GAAGH,UAAU,CAACI,KAAX,GAAmB,EAAxC;AACA,MAAMC,YAAY,GAAG,IAArB;;AAEA,MAAMC,gBAAgB,GAAIC,CAAD,IAAe;AACtC,QAAMC,CAAC,GAAGD,CAAC,GAAGP,UAAU,CAACI,KAAzB;AACA,QAAMK,CAAC,GAAGN,YAAY,GAAGI,CAAzB;AACA,SAAO,EAAEC,CAAC,GAAGC,CAAN,CAAP;AACD,CAJD;;AAMA,MAAMC,MAAM,GAAGC,wBAAWC,MAAX,CAAkB;AAC/BC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,IAAI,EAAE,CADE;AAERC,IAAAA,eAAe,EAAE;AAFT,GADqB;AAK/BC,EAAAA,KAAK,EAAE;AACLF,IAAAA,IAAI,EAAE,CADD;AAELG,IAAAA,aAAa,EAAE;AAFV;AALwB,CAAlB,CAAf;;AAWA,MAAMC,aAAa,GAAGC,+BAASC,uBAAT,CACpBC,kBADoB,CAAtB;;AAQA,SAASC,MAAT,CAAgB;AAAElB,EAAAA;AAAF,CAAhB,EAAyC;AACvC,sBAAO,6BAAC,iBAAD;AAAM,IAAA,KAAK,EAAE;AAAEA,MAAAA;AAAF;AAAb,IAAP;AACD;;AAYD,MAAMmB,IAAI,gBAAGC,eAAMC,IAAN,CACX,CAAC;AACCC,EAAAA,YADD;AAECC,EAAAA,SAFD;AAGCC,EAAAA,IAHD;AAICC,EAAAA,iBAJD;AAKCC,EAAAA,WALD;AAMCC,EAAAA,KAND;AAOCC,EAAAA;AAPD,CAAD,KAQM;AACJ,MAAI,CAACN,YAAL,EAAmB;AACjB,WAAO,IAAP;AACD;;AAED,QAAMO,WAAW,GAAGjC,UAAU,CAACI,KAA/B;AACA,QAAM8B,WAAW,GAAGN,IAAI,CAACO,IAAL,CAAU/B,KAAV,GAAkB6B,WAAtC;AACA,QAAMG,YAAY,GAAGR,IAAI,CAACO,IAAL,CAAUE,MAAV,GAAmBH,WAAxC;AAEA,sBACE,6BAAC,iBAAD;AACE,IAAA,KAAK,EAAE;AACLpB,MAAAA,IAAI,EAAE,CADD;AAELwB,MAAAA,QAAQ,EAAE,UAFL;AAGLC,MAAAA,GAAG,EAAE,CAHA;AAILC,MAAAA,MAAM,EAAE,CAJH;AAKLC,MAAAA,IAAI,EAAE,CAACnC,gBAAgB,CAACyB,KAAD;AALlB;AADT,kBASE,6BAAC,iBAAD;AACE,IAAA,KAAK,EAAE,CACL;AACEjB,MAAAA,IAAI,EAAE,CADR;AAEEV,MAAAA,KAAK,EAAEJ,UAAU,CAACI,KAFpB;AAGEsC,MAAAA,cAAc,EAAE,QAHlB;AAIEC,MAAAA,UAAU,EAAE;AAJd,KADK;AADT,kBAUE,6BAAC,kCAAD,EACM;AACFhB,IAAAA,SADE;AAEFE,IAAAA,iBAFE;AAGFe,IAAAA,GAAG,EAAEhB,IAAI,CAACO,IAAL,CAAUS,GAHb;AAIFxC,IAAAA,KAAK,EAAE6B,WAJL;AAKFI,IAAAA,MAAM,EAAED;AALN,GADN,CAVF,CATF,EA8BGL,KAAK,KAAKC,MAAM,GAAG,CAAnB,iBAAwB,6BAAC,MAAD;AAAQ,IAAA,KAAK,EAAEF;AAAf,IA9B3B,CADF;AAkCD,CApDU,CAAb;;AAuDA,MAAMe,YAAY,GAAG;AACnBC,EAAAA,QAAQ,EAAE,GADS;AAEnBC,EAAAA,MAAM,EAAEC,8BAAOC,MAAP,CAAc,IAAd,EAAoB,IAApB,EAA0B,CAA1B,EAA6B,CAA7B;AAFW,CAArB;;AASO,SAASC,UAAT,CAAoB;AAAEC,EAAAA;AAAF,CAApB,EAA8C;AACnD;AAEA,QAAMC,QAAQ,GAAG,mBAAO,IAAP,CAAjB;AACA,QAAMC,MAAM,GAAG,mBAAO,IAAP,CAAf;AAEA,QAAMC,QAAQ,GAAG,2CAAe,IAAf,CAAjB;;AAEA,WAASzB,iBAAT,CAA2B0B,KAA3B,EAA2C;AACzC;;AAEAD,IAAAA,QAAQ,CAACC,KAAT,GAAiBA,KAAjB;AACD;;AAED,QAAMC,oBAAoB,GAAG,2CAAe,CAAf,CAA7B;AACA,QAAMC,aAAa,GAAG,2CAAepD,YAAf,CAAtB;;AAEA,QAAMqD,eAAe,GAAIH,KAAD,IAAoB;AAC1C;;AAEAC,IAAAA,oBAAoB,CAACD,KAArB,GAA6BA,KAAK,GAAGlD,YAAH,GAAkB,CAApD;AACAoD,IAAAA,aAAa,CAACF,KAAd,GAAsBA,KAAK,GAAG,CAAH,GAAOlD,YAAlC;AACD,GALD,CAjBmD,CAwBnD;;;AACA,QAAM;AAAEsD,IAAAA,YAAF;AAAgBxB,IAAAA;AAAhB,MAAyBgB,OAAO,CAACS,UAAvC;;AAEA,MAAI,CAACD,YAAL,EAAmB;AACjB,UAAM,IAAIE,KAAJ,CACJ,qDADI,CAAN;AAGD;;AAED,QAAM,CAACC,WAAD,EAAcC,cAAd,IAAgC,qBAAS5B,IAAI,CAACS,GAAd,CAAtC;AAEA,QAAMoB,iBAAiB,GAAG,2CAAe,CAAf,CAA1B;AACA,QAAMC,KAAK,GAAG,2CAAe,CAAf,CAAd;AACA,QAAMC,eAAe,GAAG,2CAAe,CAAf,CAAxB;AACA,QAAMC,YAAY,GAAGC,sBAASC,EAAT,KAAgB,SAAhB,GAA4B,EAA5B,GAAiC,CAAtD;AAEA,QAAMC,QAAQ,GAAG,2CAAe,CAAf,CAAjB;AACA,QAAMC,CAAC,GAAG,2CAAeZ,YAAY,CAACY,CAA5B,CAAV;AACA,QAAMnE,KAAK,GAAG,2CAAeuD,YAAY,CAACvD,KAA5B,CAAd;AACA,QAAMiC,MAAM,GAAG,2CAAesB,YAAY,CAACtB,MAA5B,CAAf;AACA,QAAMJ,WAAW,GAAG,2CAAe0B,YAAY,CAAC1B,WAA5B,CAApB;AACA,QAAMG,YAAY,GAAG,2CAAeuB,YAAY,CAACvB,YAA5B,CAArB;AACA,QAAMoC,CAAC,GAAG,2CAAeb,YAAY,CAACa,CAA5B,CAAV;AACA,QAAMC,MAAM,GAAGC,GAAG,CAACC,eAAJ,CACb,CADa,EAEb,CAAC3E,UAAU,CAACqC,MAAX,GAAoBsB,YAAY,CAACvB,YAAlC,IAAkD,CAAlD,GACE+B,YAHW,CAAf;AAKA,QAAMS,SAAS,GAAGF,GAAG,CAACC,eAAJ,CAAoB,CAApB,EAAuB,CAAvB,CAAlB;AAEA,QAAM,CAACE,SAAD,EAAYC,YAAZ,IAA4B,qBAAS,CAAT,CAAlC;AAEA,wBAAU,MAAM;AACd,UAAMC,QAAQ,GAAG5B,OAAO,CAAC6B,mBAAR,CAA6BC,QAAD,IAAc;AACzD,UAAI,CAACA,QAAQ,CAACtB,YAAd,EAA4B;AAC1B,cAAM,IAAIE,KAAJ,CAAU,+BAAV,CAAN;AACD;;AAEDU,MAAAA,CAAC,CAAChB,KAAF,GAAU0B,QAAQ,CAACtB,YAAT,CAAsBY,CAAhC;AACAnE,MAAAA,KAAK,CAACmD,KAAN,GAAc0B,QAAQ,CAACtB,YAAT,CAAsBvD,KAApC;AACAiC,MAAAA,MAAM,CAACkB,KAAP,GAAe0B,QAAQ,CAACtB,YAAT,CAAsBtB,MAArC;AACAJ,MAAAA,WAAW,CAACsB,KAAZ,GAAoB0B,QAAQ,CAACtB,YAAT,CAAsB1B,WAA1C;AACAG,MAAAA,YAAY,CAACmB,KAAb,GAAqB0B,QAAQ,CAACtB,YAAT,CAAsBvB,YAA3C;AACAoC,MAAAA,CAAC,CAACjB,KAAF,GAAU0B,QAAQ,CAACtB,YAAT,CAAsBa,CAAhC;AACAC,MAAAA,MAAM,CAACD,CAAP,CAASjB,KAAT,GACE,CAACvD,UAAU,CAACqC,MAAX,GAAoB4C,QAAQ,CAACtB,YAAT,CAAsBvB,YAA3C,IAA2D,CAA3D,GACA+B,YAFF;AAIAJ,MAAAA,cAAc,CAACkB,QAAQ,CAAC9C,IAAT,CAAcS,GAAf,CAAd;AAEAsC,MAAAA,sBAAsB,CAAC,CAAD,CAAtB;AACD,KAlBgB,CAAjB;AAoBA,WAAOH,QAAP;AACD,GAtBD,EAsBG,EAtBH;;AAwBA,WAASG,sBAAT,CAAgC3B,KAAhC,EAA8C;AAC5C,QAAI;AACFJ,MAAAA,OAAO,CAACS,UAAR,CAAoBuB,OAApB,CAA4B5B,KAA5B,GAAoCA,KAApC;AACD,KAFD,CAEE,OAAO6B,GAAP,EAAY;AACZ;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACD;AACF,GAvFkD,CAyFnD;;;AACA,WAASC,SAAT,GAAqB;AACnBL,IAAAA,sBAAsB,CAAC,CAAD,CAAtB;AACAJ,IAAAA,YAAY,CAAC,CAAD,CAAZ;AACD;;AAED,WAASU,OAAT,GAAmB;AACjBN,IAAAA,sBAAsB,CAAC,CAAD,CAAtB;AAEA/B,IAAAA,OAAO,CAACqC,OAAR;AACD,GAnGkD,CAqGnD;;;AACA,QAAMC,aAAa,GAAG,MAAM;AAC1B;;AAEAzB,IAAAA,iBAAiB,CAACT,KAAlB,GAA0B,uCAAW,CAAX,EAAcV,YAAd,EAA4B,MAAM;AAC1Da,MAAAA,eAAe,CAAC,IAAD,CAAf;AACA6B,MAAAA,SAAS;AACV,KAHyB,CAA1B;AAIArB,IAAAA,eAAe,CAACX,KAAhB,GAAwB,uCAAW,CAAX,EAAcV,YAAd,CAAxB;AACD,GARD;;AAUA,wBAAU,MAAM;AACd,wCAAQ4C,aAAR;AACD,GAFD,EAEG,EAFH,EAhHmD,CAoHnD;;AAEA,QAAMC,WAAW,GAAG,6CAA6B,MAAM;AACrD,UAAMnF,CAAC,GAAIoF,KAAD,IACR,wCACE3B,iBAAiB,CAACT,KADpB,EAEE,CAAC,CAAD,EAAI,CAAJ,CAFF,EAGEoC,KAHF,EAIEC,mCAAYC,KAJd,CADF;;AAQA,UAAMC,UAAU,GACdlB,SAAS,CAACJ,CAAV,CAAYjB,KAAZ,GAAoBhD,CAAC,CAAC,CAACiE,CAAC,CAACjB,KAAH,EAAUkB,MAAM,CAACD,CAAP,CAASjB,KAAnB,CAAD,CADvB;AAEA,UAAMwC,UAAU,GACdnB,SAAS,CAACL,CAAV,CAAYhB,KAAZ,GAAoBhD,CAAC,CAAC,CAACgE,CAAC,CAAChB,KAAH,EAAUkB,MAAM,CAACF,CAAP,CAAShB,KAAnB,CAAD,CADvB;AAGA,WAAO;AACLhB,MAAAA,GAAG,EAAEuD,UADA;AAELrD,MAAAA,IAAI,EAAEsD,UAFD;AAGL3F,MAAAA,KAAK,EAAEG,CAAC,CAAC,CAACH,KAAK,CAACmD,KAAP,EAActB,WAAW,CAACsB,KAA1B,CAAD,CAHH;AAILlB,MAAAA,MAAM,EAAE9B,CAAC,CAAC,CAAC8B,MAAM,CAACkB,KAAR,EAAenB,YAAY,CAACmB,KAA5B,CAAD,CAJJ;AAKLyC,MAAAA,SAAS,EAAE,CACT;AACE/B,QAAAA,KAAK,EAAEA,KAAK,CAACV;AADf,OADS;AALN,KAAP;AAWD,GAzBmB,CAApB;AA2BA,QAAM0C,cAAc,GAAG,6CAA4B,MAAM;AACvD,WAAO;AACLd,MAAAA,OAAO,EAAEjB,eAAe,CAACX;AADpB,KAAP;AAGD,GAJsB,CAAvB,CAjJmD,CAuJnD;;AACA,QAAM,CAAC2C,WAAD,EAAcC,cAAd,IAAgC,qBACpChD,OAAO,CAACS,UAAR,CAAoB7B,KADgB,CAAtC;AAIA,QAAMA,KAAK,GAAG,2CAAeoB,OAAO,CAACS,UAAR,CAAoB7B,KAAnC,CAAd;AACA,QAAMC,MAAM,GAAG,2CAAemB,OAAO,CAACiD,UAAvB,CAAf;AACA,QAAMC,MAAM,GAAG,2CAAe,CAAf,CAAf;AACA,QAAMC,gBAAgB,GAAG,2CACvBhG,gBAAgB,CAAC6C,OAAO,CAACS,UAAR,CAAoB7B,KAArB,CADO,CAAzB;AAGA,QAAMwE,mBAAmB,GAAG,2CAAe,CAAf,CAA5B;AAEA,QAAMC,OAAO,GAAG,2CACdlG,gBAAgB,CAAC6C,OAAO,CAACS,UAAR,CAAoB7B,KAArB,CADF,CAAhB;AAIA,QAAM0E,UAAU,GAAG,4CAAgB,MAAM;AACvC,WACEzE,MAAM,CAACuB,KAAP,GAAevD,UAAU,CAACI,KAA1B,GACAD,YAAY,GAAG6B,MAAM,CAACuB,KADtB,GAEA,CAHF;AAKD,GANkB,CAAnB;;AAQA,QAAMmD,YAAY,GAAInG,CAAD,IAAe;AAClC;;AAEA,UAAMC,CAAC,GAAGD,CAAC,GAAGP,UAAU,CAACI,KAAzB;AACA,UAAMK,CAAC,GAAGN,YAAY,GAAGI,CAAzB;AACA,WAAOC,CAAC,GAAGC,CAAX;AACD,GAND;;AAQA,iBAAekG,aAAf,GAA+B;AAC7B,UAAMC,SAAS,GAAG7E,KAAK,CAACwB,KAAxB;AACA2B,IAAAA,sBAAsB,CAAC,CAAD,CAAtB;AAEA,UAAM/B,OAAO,CAACgD,cAAR,CAAuBS,SAAvB,CAAN;AAEAT,IAAAA,cAAc,CAACS,SAAD,CAAd;AACD;;AAED,QAAMC,qBAAqB,GAAG,MAAM;AAClC;;AAEAL,IAAAA,OAAO,CAACjD,KAAR,GAAgB,uCAAW+C,gBAAgB,CAAC/C,KAA5B,EAAmC;AACjDuD,MAAAA,SAAS,EAAE,IADsC;AAEjDC,MAAAA,OAAO,EAAE,GAFwC;AAGjDC,MAAAA,IAAI,EAAE,CAH2C;AAIjDC,MAAAA,iBAAiB,EAAE,IAJ8B;AAKjDC,MAAAA,yBAAyB,EAAE,IALsB;AAMjDC,MAAAA,kBAAkB,EAAE,IAN6B;AAOjD7C,MAAAA,QAAQ,EAAEA,QAAQ,CAACf;AAP8B,KAAnC,CAAhB;AASD,GAZD,CAjMmD,CA+MnD;;;AACA,QAAM6D,QAAQ,GAAG,4CAAgB,MAAM;AACrC,UAAMC,aAAa,GAAGb,OAAO,CAACjD,KAAR,GAAgBgD,mBAAmB,CAAChD,KAA1D;;AAEA,QAAI8D,aAAa,GAAG,CAApB,EAAuB;AACrB,aAAO,KAAP;AACD;;AAED,UAAMC,cAAc,GAClBtH,UAAU,CAACI,KAAX,IAAoB4B,MAAM,CAACuB,KAAP,GAAe,CAAnC,IACApD,YAAY,IAAI6B,MAAM,CAACuB,KAAP,GAAe,CAAnB,CAFd;;AAIA,QAAI8D,aAAa,IAAI,CAACC,cAAtB,EAAsC;AACpC,aAAO,KAAP;AACD;;AAED,WAAO,IAAP;AACD,GAhBgB,CAAjB;;AAkBA,QAAMC,YAAY,GAAIC,CAAD,IAAe;AAClC;;AAEA,UAAMC,gBAAgB,GAAGC,IAAI,CAACC,GAAL,CAASjB,YAAY,CAAC3E,KAAK,CAACwB,KAAP,CAArB,CAAzB;AACA,UAAMqE,YAAY,GAAG7F,KAAK,CAACwB,KAA3B;AACA,UAAMsE,aAAa,GAAGH,IAAI,CAACC,GAAL,CAASnB,OAAO,CAACjD,KAAjB,CAAtB;AAEA,UAAMqD,SAAS,GAAGY,CAAC,GAAG,CAAJ,GAAQI,YAAY,GAAG,CAAvB,GAA2BA,YAAY,GAAG,CAA5D;;AAEA,QACEhB,SAAS,GAAGgB,YAAZ,IACAC,aAAa,GAAGJ,gBAFlB,EAGE;AACA,aAAOG,YAAP;AACD;;AAED,QACEhB,SAAS,GAAGgB,YAAZ,IACAC,aAAa,GAAGJ,gBAFlB,EAGE;AACA,aAAOG,YAAP;AACD;;AAED,QAAIhB,SAAS,GAAG5E,MAAM,CAACuB,KAAP,GAAe,CAA3B,IAAgCqD,SAAS,GAAG,CAAhD,EAAmD;AACjD,aAAOgB,YAAP;AACD;;AAED,WAAOhB,SAAP;AACD,GA5BD;;AA8BA,QAAMkB,iBAAiB,GAAG,4CAAgB,MAAM;AAC9C,WACEJ,IAAI,CAACK,KAAL,CAAWrB,YAAY,CAAC3E,KAAK,CAACwB,KAAP,CAAvB,MACAmE,IAAI,CAACK,KAAL,CAAWL,IAAI,CAACC,GAAL,CAASnB,OAAO,CAACjD,KAAR,GAAgB8C,MAAM,CAAC9C,KAAhC,CAAX,CAFF;AAID,GALyB,CAA1B;AAOA,QAAMyE,KAAK,GAAG,0DAKZ;AACAC,IAAAA,iBAAiB,EAAGC,GAAD,IAAS;AAC1B,aACEA,GAAG,CAACC,gBAAJ,KAAyB,CAAzB,IACA7E,QAAQ,CAACC,KADT,IAEAS,iBAAiB,CAACT,KAAlB,KAA4B,CAH9B;AAKD,KAPD;AASA6E,IAAAA,OAAO,EAAGF,GAAD,IAAS;AAChB3B,MAAAA,mBAAmB,CAAChD,KAApB,GAA4B2E,GAAG,CAACG,YAAhC;AACA/D,MAAAA,QAAQ,CAACf,KAAT,GAAiB2E,GAAG,CAACI,SAArB;AACD,KAZD;AAcAC,IAAAA,OAAO,EAAE,CAACL,GAAD,EAAMM,GAAN,KAAc;AACrB,YAAMC,iBAAiB,GACrBf,IAAI,CAACC,GAAL,CAASO,GAAG,CAACI,SAAb,IAA0BZ,IAAI,CAACC,GAAL,CAASO,GAAG,CAACQ,SAAb,CAD5B;;AAGA,UAAID,iBAAiB,IAAIX,iBAAiB,CAACvE,KAA3C,EAAkD;AAChDG,QAAAA,eAAe,CAAC,IAAD,CAAf;AACA8E,QAAAA,GAAG,CAACG,WAAJ,GAAkB,IAAlB;AACD,OAHD,MAGO;AACLjF,QAAAA,eAAe,CAAC,KAAD,CAAf;AACD;AACF,KAxBD;AA0BAkF,IAAAA,QAAQ,EAAE,CAACV,GAAD,EAAMM,GAAN,KAAc;AACtB,UAAIA,GAAG,CAACG,WAAR,EAAqB;AACnBtC,QAAAA,MAAM,CAAC9C,KAAP,GAAe6D,QAAQ,CAAC7D,KAAT,GACX2E,GAAG,CAACG,YADO,GAEX,qBAASH,GAAG,CAACG,YAAb,CAFJ;AAGD,OAJD,MAIO;AACLzD,QAAAA,SAAS,CAACJ,CAAV,CAAYjB,KAAZ,GAAoB2E,GAAG,CAACW,YAAxB;AACAjE,QAAAA,SAAS,CAACL,CAAV,CAAYhB,KAAZ,GAAoB2E,GAAG,CAACG,YAAxB;AAEApE,QAAAA,KAAK,CAACV,KAAN,GAAc,wCACZqB,SAAS,CAACJ,CAAV,CAAYjB,KADA,EAEZ,CAAC,CAAC,GAAF,EAAO,CAAP,EAAU,GAAV,CAFY,EAGZ,CAAC,IAAD,EAAO,CAAP,EAAU,IAAV,CAHY,EAIZqC,mCAAYC,KAJA,CAAd;AAOA3B,QAAAA,eAAe,CAACX,KAAhB,GAAwB,wCACtBqB,SAAS,CAACJ,CAAV,CAAYjB,KADU,EAEtB,CAAC,CAAC,GAAF,EAAO,CAAP,EAAU,GAAV,CAFsB,EAGtB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHsB,EAItBqC,mCAAYC,KAJU,CAAxB;AAMD;AACF,KAjDD;AAmDAiD,IAAAA,KAAK,EAAE,CAACZ,GAAD,EAAMM,GAAN,KAAc;AACnB,UAAIA,GAAG,CAACG,WAAR,EAAqB;AACnBnC,QAAAA,OAAO,CAACjD,KAAR,IAAiB8C,MAAM,CAAC9C,KAAxB;AACA8C,QAAAA,MAAM,CAAC9C,KAAP,GAAe,CAAf;AAEA,cAAMqD,SAAS,GAAGW,YAAY,CAACW,GAAG,CAACI,SAAL,CAA9B;AAEA,cAAMd,CAAC,GAAGE,IAAI,CAACC,GAAL,CAASO,GAAG,CAACI,SAAb,CAAV;AAEA,cAAMS,oBAAoB,GAAGvB,CAAC,GAAG,EAAJ,IAAUJ,QAAQ,CAAC7D,KAAhD,CARmB,CAUnB;;AACA+C,QAAAA,gBAAgB,CAAC/C,KAAjB,GAAyB,EAAEwF,oBAAoB,GAC3CrC,YAAY,CAACE,SAAD,CAD+B,GAE3CF,YAAY,CAAC3E,KAAK,CAACwB,KAAP,CAFS,CAAzB;AAIAsD,QAAAA,qBAAqB;;AAErB,YAAIkC,oBAAJ,EAA0B;AACxBhH,UAAAA,KAAK,CAACwB,KAAN,GAAcqD,SAAd;AACAD,UAAAA,aAAa;AACd;AACF,OArBD,MAqBO;AACL,cAAM5D,MAAM,GAAGC,8BAAOC,MAAP,CAAc,IAAd,EAAoB,IAApB,EAA0B,CAA1B,EAA6B,CAA7B,CAAf;;AACA,cAAM+F,MAAM,GAAG;AACblG,UAAAA,QAAQ,EAAE,GADG;AAEbC,UAAAA;AAFa,SAAf;;AAKA,YAAI2E,IAAI,CAACC,GAAL,CAAS/C,SAAS,CAACJ,CAAV,CAAYjB,KAArB,IAA8B,EAAlC,EAAsC;AACpCkB,UAAAA,MAAM,CAACF,CAAP,CAAShB,KAAT,GAAiBqB,SAAS,CAACL,CAAV,CAAYhB,KAAZ,GAAoBkB,MAAM,CAACF,CAAP,CAAShB,KAAT,GAAiB,CAAC,CAAvD;AACAkB,UAAAA,MAAM,CAACD,CAAP,CAASjB,KAAT,GAAiBqB,SAAS,CAACJ,CAAV,CAAYjB,KAAZ,GAAoBkB,MAAM,CAACD,CAAP,CAASjB,KAAT,GAAiB,CAAC,CAAvD;AAEAqB,UAAAA,SAAS,CAACL,CAAV,CAAYhB,KAAZ,GAAoB,CAApB;AACAqB,UAAAA,SAAS,CAACJ,CAAV,CAAYjB,KAAZ,GAAoB,CAApB;AAEAS,UAAAA,iBAAiB,CAACT,KAAlB,GAA0B,uCACxB,CADwB,EAExB;AACET,YAAAA,QAAQ,EAAE,GADZ;AAEEC,YAAAA;AAFF,WAFwB,EAMxB,MAAM;AACJyC,YAAAA,OAAO;AACR,WARuB,CAA1B;AAUAvB,UAAAA,KAAK,CAACV,KAAN,GAAc,uCAAW,CAAX,EAAc;AAC1BT,YAAAA,QAAQ,EAAE,GADgB;AAE1BC,YAAAA;AAF0B,WAAd,CAAd;AAKAmB,UAAAA,eAAe,CAACX,KAAhB,GAAwB,uCAAW,CAAX,EAAcyF,MAAd,CAAxB;AACD,SAvBD,MAuBO;AACLpE,UAAAA,SAAS,CAACL,CAAV,CAAYhB,KAAZ,GAAoB,uCAAW,CAAX,EAAcyF,MAAd,CAApB;AACApE,UAAAA,SAAS,CAACJ,CAAV,CAAYjB,KAAZ,GAAoB,uCAAW,CAAX,EAAcyF,MAAd,CAApB;AACA9E,UAAAA,eAAe,CAACX,KAAhB,GAAwB,uCAAW,CAAX,EAAcyF,MAAd,CAAxB;AACA/E,UAAAA,KAAK,CAACV,KAAN,GAAc,uCAAW,CAAX,EAAcyF,MAAd,EAAsB,MAAM;AACxCtF,YAAAA,eAAe,CAAC,IAAD,CAAf;AACD,WAFa,CAAd;AAGD;AACF;AACF,KAhHD;AAkHAuF,IAAAA,QAAQ,EAAE,CAACC,CAAD,EAAIV,GAAJ,KAAY;AACpBA,MAAAA,GAAG,CAACG,WAAJ,GAAkB,KAAlB;AACD;AApHD,GALY,CAAd;AA4HA,QAAMQ,KAAK,GAAG,0DAA0B;AACtClB,IAAAA,iBAAiB,EAAGC,GAAD,IAAS;AAC1B,aACEA,GAAG,CAACC,gBAAJ,KAAyB,CAAzB,IACA7E,QAAQ,CAACC,KADT,IAEAS,iBAAiB,CAACT,KAAlB,KAA4B,CAH9B;AAKD,KAPqC;AAStCgF,IAAAA,OAAO,EAAE,MAAM;AACb,UAAItE,KAAK,CAACV,KAAN,KAAgB,CAApB,EAAuB;AACrB;AACD;;AACD,kDAAgBiD,OAAhB;AACD,KAdqC;AAgBtCsC,IAAAA,KAAK,EAAE,MAAM;AACX,UAAI7E,KAAK,CAACV,KAAN,KAAgB,CAApB,EAAuB;AACrB;AACD;;AAEDsD,MAAAA,qBAAqB;AACtB;AAtBqC,GAA1B,CAAd;AAyBA,QAAMuC,kBAAkB,GAAG,6CAAiB,MAAM;AAChD,WAAO;AACLpD,MAAAA,SAAS,EAAE,CACT;AACEF,QAAAA,UAAU,EAAErC,aAAa,CAACF;AAD5B,OADS;AADN,KAAP;AAOD,GAR0B,CAA3B;AAUA,QAAM8F,WAAW,GAAG,6CAA4B,MAAM;AACpD,WAAO;AACLjJ,MAAAA,KAAK,EAAEqG,UAAU,CAAClD,KADb;AAELyC,MAAAA,SAAS,EAAE,CACT;AACED,QAAAA,UAAU,EAAEM,MAAM,CAAC9C,KAAP,GAAeiD,OAAO,CAACjD;AADrC,OADS;AAFN,KAAP;AAQD,GATmB,CAApB;AAWA,QAAM+F,kBAAkB,GAAG,6CAA4B,MAAM;AAC3D,WAAO;AACLtD,MAAAA,SAAS,EAAE,CACT;AACED,QAAAA,UAAU,EAAEvC,oBAAoB,CAACD;AADnC,OADS;AADN,KAAP;AAOD,GAR0B,CAA3B;AAUA,sBACE,6BAAC,iBAAD;AAAM,IAAA,KAAK,EAAE5C,wBAAW4I;AAAxB,kBACE,6BAAC,8BAAD,CAAU,IAAV;AAAe,IAAA,KAAK,EAAE,CAAC7I,MAAM,CAACG,QAAR,EAAkBoF,cAAlB;AAAtB,IADF,eAGE,6BAAC,8BAAD,CAAU,IAAV;AAAe,IAAA,KAAK,EAAE,CAACtF,wBAAW6I,YAAZ;AAAtB,kBACE,6BAAC,4CAAD;AACE,IAAA,GAAG,EAAEpG,QADP;AAEE,IAAA,oBAAoB,EAAE,CAACC,MAAD,CAFxB;AAGE,IAAA,cAAc,EAAE2E,KAHlB;AAIE,IAAA,oBAAoB,EAAEA;AAJxB,kBAME,6BAAC,8BAAD,CAAU,IAAV;AAAe,IAAA,KAAK,EAAErH,wBAAW6I;AAAjC,kBACE,6BAAC,8BAAD,CAAU,IAAV;AACE,IAAA,KAAK,EAAE,CAAC7I,wBAAW6I,YAAZ,EAA0BF,kBAA1B;AADT,kBAGE,6BAAC,aAAD;AACE,IAAA,MAAM,EAAE;AAAE1G,MAAAA,GAAG,EAAEkB;AAAP,KADV;AAEE,IAAA,KAAK,EAAE4B;AAFT,IAHF,CADF,eAUE,6BAAC,8BAAD,CAAU,IAAV;AACE,IAAA,KAAK,EAAE,CAAC/E,wBAAW6I,YAAZ,EAA0BJ,kBAA1B;AADT,kBAGE,6BAAC,4CAAD;AACE,IAAA,GAAG,EAAE/F,MADP,CAEE;AAFF;AAGE,IAAA,OAAO,EAAE,KAHX;AAIE,IAAA,oBAAoB,EAAE,CAACD,QAAD,CAJxB;AAKE,IAAA,cAAc,EAAE+F,KALlB;AAME,IAAA,oBAAoB,EAAEA;AANxB,kBAQE,6BAAC,8BAAD,CAAU,IAAV;AAAe,IAAA,KAAK,EAAExI,wBAAW6I;AAAjC,kBACE,6BAAC,8BAAD,CAAU,IAAV;AAAe,IAAA,KAAK,EAAE,CAAC9I,MAAM,CAACM,KAAR,EAAeqI,WAAf;AAAtB,KACGlG,OAAO,CAACsG,MAAR,CAAeC,GAAf,CAAmB,CAAC9H,IAAD,EAAOrB,CAAP,kBAClB,6BAAC,IAAD;AACE,IAAA,GAAG,EAAEA,CAAC,CAACoJ,QAAF,EADP;AAEE,IAAA,IAAI,EAAE/H,IAFR;AAGE,IAAA,SAAS,EAAE,CAACwB,QAAD,EAAWC,MAAX,CAHb;AAIE,IAAA,iBAAiB,EAAExB,iBAJrB;AAKE,IAAA,KAAK,EAAEtB,CALT;AAME,IAAA,MAAM,EAAE4C,OAAO,CAACiD,UANlB;AAOE,IAAA,YAAY,EAAE,4BACZ7F,CADY,EAEZ2F,WAFY,EAGZrB,SAHY,CAPhB;AAYE,IAAA,WAAW,EAAE1E;AAZf,IADD,CADH,CADF,CARF,CAHF,CAVF,CANF,CADF,CAHF,CADF;AA2DD","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport Animated, {\n  runOnUI,\n  useSharedValue,\n  useAnimatedStyle,\n  interpolate,\n  Easing,\n  Extrapolate,\n  withTiming,\n  withSpring,\n  cancelAnimation,\n  useDerivedValue,\n} from 'react-native-reanimated';\nimport {\n  Dimensions,\n  StyleSheet,\n  View,\n  Image,\n  Platform,\n  ViewStyle,\n  ImageStyle,\n} from 'react-native';\nimport {\n  PanGestureHandler,\n  TapGestureHandler,\n  PanGestureHandlerGestureEvent,\n} from 'react-native-gesture-handler';\nimport { GalleryState, IGalleryImage } from './GalleryState';\nimport { useAnimatedGestureHandler } from './useAnimatedGestureHandler';\nimport { ImageTransformer } from './ImageTransformer';\n\nimport {\n  friction,\n  fixGestureHandler,\n  getShouldRender,\n} from './utils';\nimport * as vec from './vectors';\n\nconst dimensions = Dimensions.get('window');\n\nconst GUTTER_WIDTH = dimensions.width / 14;\nconst FAR_FAR_AWAY = 9999;\n\nconst getPageTranslate = (i: number) => {\n  const t = i * dimensions.width;\n  const g = GUTTER_WIDTH * i;\n  return -(t + g);\n};\n\nconst styles = StyleSheet.create({\n  backdrop: {\n    flex: 1,\n    backgroundColor: 'black',\n  },\n  pager: {\n    flex: 1,\n    flexDirection: 'row',\n  },\n});\n\nconst AnimatedImage = Animated.createAnimatedComponent(\n  Image,\n) as typeof Animated.Image;\n\ntype IGutterProps = {\n  width: number;\n};\n\nfunction Gutter({ width }: IGutterProps) {\n  return <View style={{ width }} />;\n}\n\ntype IPageProps = {\n  shouldRender: boolean;\n  pagerRefs: React.Ref<any>[];\n  page: IGalleryImage;\n  onPageStateChange: (value: boolean) => void;\n  gutterWidth: number;\n  index: number;\n  length: number;\n};\n\nconst Page = React.memo<IPageProps>(\n  ({\n    shouldRender,\n    pagerRefs,\n    page,\n    onPageStateChange,\n    gutterWidth,\n    index,\n    length,\n  }) => {\n    if (!shouldRender) {\n      return null;\n    }\n\n    const targetWidth = dimensions.width;\n    const scaleFactor = page.item.width / targetWidth;\n    const targetHeight = page.item.height / scaleFactor;\n\n    return (\n      <View\n        style={{\n          flex: 1,\n          position: 'absolute',\n          top: 0,\n          bottom: 0,\n          left: -getPageTranslate(index),\n        }}\n      >\n        <View\n          style={[\n            {\n              flex: 1,\n              width: dimensions.width,\n              justifyContent: 'center',\n              alignItems: 'center',\n            },\n          ]}\n        >\n          <ImageTransformer\n            {...{\n              pagerRefs,\n              onPageStateChange,\n              uri: page.item.uri,\n              width: targetWidth,\n              height: targetHeight,\n            }}\n          />\n        </View>\n\n        {index !== length - 1 && <Gutter width={gutterWidth} />}\n      </View>\n    );\n  },\n);\n\nconst timingConfig = {\n  duration: 250,\n  easing: Easing.bezier(0.33, 0.01, 0, 1),\n};\n\ntype IImagePager = {\n  gallery: GalleryState;\n};\n\nexport function ImagePager({ gallery }: IImagePager) {\n  fixGestureHandler();\n\n  const pagerRef = useRef(null);\n  const tapRef = useRef(null);\n\n  const isActive = useSharedValue(true);\n\n  function onPageStateChange(value: boolean) {\n    'worklet';\n\n    isActive.value = value;\n  }\n\n  const imageWrapperPosition = useSharedValue(0);\n  const pagerPosition = useSharedValue(FAR_FAR_AWAY);\n\n  const setPagerVisible = (value: boolean) => {\n    'worklet';\n\n    imageWrapperPosition.value = value ? FAR_FAR_AWAY : 0;\n    pagerPosition.value = value ? 0 : FAR_FAR_AWAY;\n  };\n\n  // S1: Image transition stuff\n  const { measurements, item } = gallery.activeItem!;\n\n  if (!measurements) {\n    throw new Error(\n      'Gallery Pager: Active item should have measurements',\n    );\n  }\n\n  const [activeImage, setActiveImage] = useState(item.uri);\n\n  const animationProgress = useSharedValue(0);\n  const scale = useSharedValue(1);\n  const backdropOpacity = useSharedValue(0);\n  const statusBarFix = Platform.OS === 'android' ? 12 : 0;\n\n  const velocity = useSharedValue(0);\n  const x = useSharedValue(measurements.x);\n  const width = useSharedValue(measurements.width);\n  const height = useSharedValue(measurements.height);\n  const targetWidth = useSharedValue(measurements.targetWidth);\n  const targetHeight = useSharedValue(measurements.targetHeight);\n  const y = useSharedValue(measurements.y);\n  const target = vec.useSharedVector(\n    0,\n    (dimensions.height - measurements.targetHeight) / 2 -\n      statusBarFix,\n  );\n  const translate = vec.useSharedVector(0, 0);\n\n  const [diffValue, setDiffValue] = useState(0);\n\n  useEffect(() => {\n    const disposer = gallery.addOnChangeListener((nextItem) => {\n      if (!nextItem.measurements) {\n        throw new Error('Item should have measurements');\n      }\n\n      x.value = nextItem.measurements.x;\n      width.value = nextItem.measurements.width;\n      height.value = nextItem.measurements.height;\n      targetWidth.value = nextItem.measurements.targetWidth;\n      targetHeight.value = nextItem.measurements.targetHeight;\n      y.value = nextItem.measurements.y;\n      target.y.value =\n        (dimensions.height - nextItem.measurements.targetHeight) / 2 -\n        statusBarFix;\n\n      setActiveImage(nextItem.item.uri);\n\n      setCurrentImageOpacity(0);\n    });\n\n    return disposer;\n  }, []);\n\n  function setCurrentImageOpacity(value: 0 | 1) {\n    try {\n      gallery.activeItem!.opacity.value = value;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.log('Error changing opacity');\n    }\n  }\n\n  // S1: Callbacks\n  function afterOpen() {\n    setCurrentImageOpacity(0);\n    setDiffValue(2);\n  }\n\n  function onClose() {\n    setCurrentImageOpacity(1);\n\n    gallery.onClose();\n  }\n\n  // S1: Animations\n  const openAnimation = () => {\n    'worklet';\n\n    animationProgress.value = withTiming(1, timingConfig, () => {\n      setPagerVisible(true);\n      afterOpen();\n    });\n    backdropOpacity.value = withTiming(1, timingConfig);\n  };\n\n  useEffect(() => {\n    runOnUI(openAnimation)();\n  }, []);\n\n  // S1: Styles\n\n  const imageStyles = useAnimatedStyle<ImageStyle>(() => {\n    const i = (range: [number, number]) =>\n      interpolate(\n        animationProgress.value,\n        [0, 1],\n        range,\n        Extrapolate.CLAMP,\n      );\n\n    const translateY =\n      translate.y.value + i([y.value, target.y.value]);\n    const translateX =\n      translate.x.value + i([x.value, target.x.value]);\n\n    return {\n      top: translateY,\n      left: translateX,\n      width: i([width.value, targetWidth.value]),\n      height: i([height.value, targetHeight.value]),\n      transform: [\n        {\n          scale: scale.value,\n        },\n      ],\n    };\n  });\n\n  const backdropStyles = useAnimatedStyle<ViewStyle>(() => {\n    return {\n      opacity: backdropOpacity.value,\n    };\n  });\n\n  // S2: Pager related stuff\n  const [activeIndex, setActiveIndex] = useState(\n    gallery.activeItem!.index,\n  );\n\n  const index = useSharedValue(gallery.activeItem!.index);\n  const length = useSharedValue(gallery.totalCount);\n  const pagerX = useSharedValue(0);\n  const toValueAnimation = useSharedValue(\n    getPageTranslate(gallery.activeItem!.index),\n  );\n  const gestureTranslationX = useSharedValue(0);\n\n  const offsetX = useSharedValue(\n    getPageTranslate(gallery.activeItem!.index),\n  );\n\n  const totalWidth = useDerivedValue(() => {\n    return (\n      length.value * dimensions.width +\n      GUTTER_WIDTH * length.value -\n      2\n    );\n  });\n\n  const getTranslate = (i: number) => {\n    'worklet';\n\n    const t = i * dimensions.width;\n    const g = GUTTER_WIDTH * i;\n    return t + g;\n  };\n\n  async function onIndexChange() {\n    const nextIndex = index.value;\n    setCurrentImageOpacity(1);\n\n    await gallery.setActiveIndex(nextIndex);\n\n    setActiveIndex(nextIndex);\n  }\n\n  const onChangePageAnimation = () => {\n    'worklet';\n\n    offsetX.value = withSpring(toValueAnimation.value, {\n      stiffness: 1000,\n      damping: 500,\n      mass: 3,\n      overshootClamping: true,\n      restDisplacementThreshold: 0.01,\n      restSpeedThreshold: 0.01,\n      velocity: velocity.value,\n    });\n  };\n\n  // S3 Pager\n  const canSwipe = useDerivedValue(() => {\n    const nextTranslate = offsetX.value + gestureTranslationX.value;\n\n    if (nextTranslate > 0) {\n      return false;\n    }\n\n    const totalTranslate =\n      dimensions.width * (length.value - 1) +\n      GUTTER_WIDTH * (length.value - 1);\n\n    if (nextTranslate <= -totalTranslate) {\n      return false;\n    }\n\n    return true;\n  });\n\n  const getNextIndex = (v: number) => {\n    'worklet';\n\n    const currentTranslate = Math.abs(getTranslate(index.value));\n    const currentIndex = index.value;\n    const currentOffset = Math.abs(offsetX.value);\n\n    const nextIndex = v < 0 ? currentIndex + 1 : currentIndex - 1;\n\n    if (\n      nextIndex < currentIndex &&\n      currentOffset > currentTranslate\n    ) {\n      return currentIndex;\n    }\n\n    if (\n      nextIndex > currentIndex &&\n      currentOffset < currentTranslate\n    ) {\n      return currentIndex;\n    }\n\n    if (nextIndex > length.value - 1 || nextIndex < 0) {\n      return currentIndex;\n    }\n\n    return nextIndex;\n  };\n\n  const isPagerInProgress = useDerivedValue(() => {\n    return (\n      Math.floor(getTranslate(index.value)) !==\n      Math.floor(Math.abs(offsetX.value + pagerX.value))\n    );\n  });\n\n  const onPan = useAnimatedGestureHandler<\n    PanGestureHandlerGestureEvent,\n    {\n      pagerActive: boolean;\n    }\n  >({\n    shouldHandleEvent: (evt) => {\n      return (\n        evt.numberOfPointers === 1 &&\n        isActive.value &&\n        animationProgress.value === 1\n      );\n    },\n\n    onEvent: (evt) => {\n      gestureTranslationX.value = evt.translationX;\n      velocity.value = evt.velocityX;\n    },\n\n    onStart: (evt, ctx) => {\n      const isHorizontalSwipe =\n        Math.abs(evt.velocityX) > Math.abs(evt.velocityY);\n\n      if (isHorizontalSwipe || isPagerInProgress.value) {\n        setPagerVisible(true);\n        ctx.pagerActive = true;\n      } else {\n        setPagerVisible(false);\n      }\n    },\n\n    onActive: (evt, ctx) => {\n      if (ctx.pagerActive) {\n        pagerX.value = canSwipe.value\n          ? evt.translationX\n          : friction(evt.translationX);\n      } else {\n        translate.y.value = evt.translationY;\n        translate.x.value = evt.translationX;\n\n        scale.value = interpolate(\n          translate.y.value,\n          [-200, 0, 200],\n          [0.65, 1, 0.65],\n          Extrapolate.CLAMP,\n        );\n\n        backdropOpacity.value = interpolate(\n          translate.y.value,\n          [-100, 0, 100],\n          [0, 1, 0],\n          Extrapolate.CLAMP,\n        );\n      }\n    },\n\n    onEnd: (evt, ctx) => {\n      if (ctx.pagerActive) {\n        offsetX.value += pagerX.value;\n        pagerX.value = 0;\n\n        const nextIndex = getNextIndex(evt.velocityX);\n\n        const v = Math.abs(evt.velocityX);\n\n        const shouldMoveToNextPage = v > 10 && canSwipe.value;\n\n        // we invert the value since the tranlationY is left to right\n        toValueAnimation.value = -(shouldMoveToNextPage\n          ? getTranslate(nextIndex)\n          : getTranslate(index.value));\n\n        onChangePageAnimation();\n\n        if (shouldMoveToNextPage) {\n          index.value = nextIndex;\n          onIndexChange();\n        }\n      } else {\n        const easing = Easing.bezier(0.33, 0.01, 0, 1);\n        const config = {\n          duration: 200,\n          easing,\n        };\n\n        if (Math.abs(translate.y.value) > 40) {\n          target.x.value = translate.x.value - target.x.value * -1;\n          target.y.value = translate.y.value - target.y.value * -1;\n\n          translate.x.value = 0;\n          translate.y.value = 0;\n\n          animationProgress.value = withTiming(\n            0,\n            {\n              duration: 400,\n              easing,\n            },\n            () => {\n              onClose();\n            },\n          );\n          scale.value = withTiming(1, {\n            duration: 400,\n            easing,\n          });\n\n          backdropOpacity.value = withTiming(0, config);\n        } else {\n          translate.x.value = withTiming(0, config);\n          translate.y.value = withTiming(0, config);\n          backdropOpacity.value = withTiming(1, config);\n          scale.value = withTiming(1, config, () => {\n            setPagerVisible(true);\n          });\n        }\n      }\n    },\n\n    onFinish: (_, ctx) => {\n      ctx.pagerActive = false;\n    },\n  });\n\n  const onTap = useAnimatedGestureHandler({\n    shouldHandleEvent: (evt) => {\n      return (\n        evt.numberOfPointers === 1 &&\n        isActive.value &&\n        animationProgress.value === 1\n      );\n    },\n\n    onStart: () => {\n      if (scale.value !== 1) {\n        return;\n      }\n      cancelAnimation(offsetX);\n    },\n\n    onEnd: () => {\n      if (scale.value !== 1) {\n        return;\n      }\n\n      onChangePageAnimation();\n    },\n  });\n\n  const pagerWrapperStyles = useAnimatedStyle(() => {\n    return {\n      transform: [\n        {\n          translateY: pagerPosition.value,\n        },\n      ],\n    };\n  });\n\n  const pagerStyles = useAnimatedStyle<ViewStyle>(() => {\n    return {\n      width: totalWidth.value,\n      transform: [\n        {\n          translateX: pagerX.value + offsetX.value,\n        },\n      ],\n    };\n  });\n\n  const imageWrapperStyles = useAnimatedStyle<ViewStyle>(() => {\n    return {\n      transform: [\n        {\n          translateX: imageWrapperPosition.value,\n        },\n      ],\n    };\n  });\n\n  return (\n    <View style={StyleSheet.absoluteFillObject}>\n      <Animated.View style={[styles.backdrop, backdropStyles]} />\n\n      <Animated.View style={[StyleSheet.absoluteFill]}>\n        <PanGestureHandler\n          ref={pagerRef}\n          simultaneousHandlers={[tapRef]}\n          onGestureEvent={onPan}\n          onHandlerStateChange={onPan}\n        >\n          <Animated.View style={StyleSheet.absoluteFill}>\n            <Animated.View\n              style={[StyleSheet.absoluteFill, imageWrapperStyles]}\n            >\n              <AnimatedImage\n                source={{ uri: activeImage }}\n                style={imageStyles}\n              />\n            </Animated.View>\n\n            <Animated.View\n              style={[StyleSheet.absoluteFill, pagerWrapperStyles]}\n            >\n              <TapGestureHandler\n                ref={tapRef}\n                // TODO: Fix tap gesture handler\n                enabled={false}\n                simultaneousHandlers={[pagerRef]}\n                onGestureEvent={onTap}\n                onHandlerStateChange={onTap}\n              >\n                <Animated.View style={StyleSheet.absoluteFill}>\n                  <Animated.View style={[styles.pager, pagerStyles]}>\n                    {gallery.images.map((page, i) => (\n                      <Page\n                        key={i.toString()}\n                        page={page}\n                        pagerRefs={[pagerRef, tapRef]}\n                        onPageStateChange={onPageStateChange}\n                        index={i}\n                        length={gallery.totalCount}\n                        shouldRender={getShouldRender(\n                          i,\n                          activeIndex,\n                          diffValue,\n                        )}\n                        gutterWidth={GUTTER_WIDTH}\n                      />\n                    ))}\n                  </Animated.View>\n                </Animated.View>\n              </TapGestureHandler>\n            </Animated.View>\n          </Animated.View>\n        </PanGestureHandler>\n      </Animated.View>\n    </View>\n  );\n}\n"]}